
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1,user-scalable=no" name="viewport">
    <title>私人订制-上传照片</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/swiper.min.css">
    <link rel="stylesheet" href="/css/animate.css">
    <script src="/javascript/jquery-1.9.1.min.js"></script>
    <script src="/javascript/swiper.min.js"></script>
    <script src="/javascript/hammer.js"></script>
    <script src="/javascript/wow.min.js"></script>
    <script src="/javascript/function.js"></script>
    <!--单独引用-->
    <link href="/css/mobiscroll-2.13.2.full.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/css/x_style.css">
	<link rel="stylesheet" href="/resources/layer/skin/layer.css">
    <script type="text/javascript" src="/javascript/jquery.qqFace.js"></script>
    <script src="/javascript/mobiscroll-2.13.2.full.min.js" type="text/javascript"></script>
    <script src="/javascript/x_function.js"></script>
    	<script src="/javascript/base64.js"></script>
		<script src="/resources/layer/layer.js"></script>
		<script src="/resources/layer/layui.js"></script>
</head>
<body class="bg childcare">
	<div class="uploadph sticky">
		<div class="tabs">
			<ul>
				<li>
					<a href="/tailor/grow.html" class="on">成长记录<i></i></a>
				</li>
				<li>
					<a href="/tailor/uploadbody.html" >成长发育<i></i></a>
				</li>
			</ul>
		</div>
		<div class="wrap">
			<div class="message_box uploadph_box">
				<!--<textarea class="message_ta" id="message_ta" placeholder="宝宝在卖萌，在发呆，还是在傻笑" name="TEXTTAREA1"></textarea>-->
				<div class="message_ta" contenteditable="true" id="message_ta" placeholder="宝宝在卖萌，在发呆，还是在傻笑" name="TEXTTAREA1"></div>
				<div class="message_num fr">
					<span class="message_num_d">0</span>/<span>300</span>
				</div>
				<div class="emoticon fr">
					<img src="/images/uploadphoto_icon.png" class="emoticon_btn" />
				</div>
			</div>
			<div class="uploadph_time">
				<span class="fl">记录时间</span>
				<div class="time fr">
					<i class="fl">当前时间</i>
					<!--<em class="fl">2018-02-05</em>-->
					<input type="text" id="nowtime" class="fl" placeholder="" name="CREATE_DATE"/>
				</div>
			</div>
			<div class="uploadph_con">
				<p>上传照片</p>
				<input type="hidden" id="hidp_id" >
				<div class="nogrow_layer">
					<div class="nogrow_layer_mask"></div>
					<ul class="nogrow_layer_box">
						<li id="btn">拍摄</li>
						<li id="btn1">从相册选择</li>
					</ul>
				</div>
				<div class="uploadph_wrap">
					<ul>
						<li id="btndlcm"><div><img src="/images/grow_upload_icon.jpg"></div></li>
					</ul>                                                            
				</div>
			</div>
		</div>
		
	</div>
	<div class="message_b sticky_footer">
		<input type="button" class="message_btn" value="上传" />
	</div> 
	<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
	<script src="/javascript/jquery.jsonp.js"></script>
   
    <script src="/javascript/sha1.js"></script>
	<script src="/resources/htjs/weixi_chooseImage.js"></script>
	 <script src="/resources/htjs/xhr_wximg.js"></script>
	 
	<script>
		$(document).ready(function(){
			/*qq表情*/
			$('.emoticon').qqFace({
		
				id : 'facebox', 
		
				assign:'message_ta', 
		
				path:'../images/arclist/'	//表情存放的路径
		
			});
		
			$("#message_ta").keyup(function(){
				
				var message = $(this).html();
				console.log(message)
//				var message1 = $(this).text();
				var message1 = $(this).html().replace(/<img src="..\/images\/arclist\/(\d+).gif" border="0">/g,"[em_$1]");
				if(message1.length > 300){
					$(this).html(replace_em(message1.substring(0,300)));
					$(".message_num_d").html(300);
					alert("字数不能超过300字！");
					keepLastIndex($(this).get(0));
				}else{
					$(".message_num_d").html(message1.length);
				}
			})
			
		})
		
		function keepLastIndex(obj) {
		    if (window.getSelection) {//ie11 10 9 ff safari
		        obj.focus(); //解决ff不获取焦点无法定位问题
		        var range = window.getSelection();//创建range
		        range.selectAllChildren(obj);//range 选择obj下所有子内容
		        range.collapseToEnd();//光标移至最后
		    }
		    else if (document.selection) {//ie10 9 8 7 6 5
		        var range = document.selection.createRange();//创建选择对象
		        //var range = document.body.createTextRange();
		        range.moveToElementText(obj);//range定位到obj
		        range.collapse(false);//光标移至最后
		        range.select();
		    }
		}
	</script>
</body>
</html>
